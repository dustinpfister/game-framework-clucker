(function(Clucker){

try{utils=Clucker?Clucker.utils={}:{}}catch(e){var utils={}}utils.noop=function(){},utils.distance=function(e,t,n,a){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-a,2))},utils.boundingBox=function(e,t,n,a,o,r,i,c){return!(t+a<r||r+c<t||e+n<o||o+i<e)},utils.mod=function(e,t){return(e%t+t)%t},utils.formatNumber=function(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},utils.wrapText=function(e,t){t=new RegExp(`(?![^\\n]{1,${t}}$)([^\\n]{1,${t}})\\s`,"g");return e.replace(t,"$1\n").split("\n")},utils.http=function(e){(e=e||{}).url=e.url||"",e.method=e.method||"GET",e.async=void 0===e.async||e.async,e.body=void 0===e.body?null:e.body,e.onDone=e.onDone||utils.noop,e.onError=e.onError||utils.noop,e.responseType=e.responseType||"";var t=new XMLHttpRequest;t.responseType=e.responseType,t.open(e.method,e.url,e.async),t.onreadystatechange=function(){4===t.readyState&&(200<=t.status&&t.status<400?e.onDone.call(t,t.response,t):e.onError.call(t,t))},t.send(e.body)},utils.httpPNG=function(a){(a=a||{}).onDone=a.onDone||utils.noop,a.onError=a.onError||utils.noop,utils.http({url:a.url,responseType:"blob",onDone:function(e,t){var e=window.URL.createObjectURL(e),n=new Image;n.src=e,n.addEventListener("load",function(){a.onDone.call(t,n,t)})},onError:a.onError})},utils.XP=function(){function r(e,t){return t=void 0===t?i:t,(Math.pow(e,2)-e)*t/2}function a(e,t,n){var a=t<(a=(o=void 0===(o=n)?i:o,(1+Math.sqrt(1+8*e/o))/2))?t:a,o=Math.floor(a),n=r(o+1,n);return{level:o,levelFrac:a,per:a%1,xp:e,forNext:a===t?1/0:n,toNext:a===t?1/0:n-e}}var i=50;return{parseByLevel:function(e,t,n){return a(r(e,n),t,n)},parseByXP:a}}(),utils.log=function(e){console.log(e)},utils.logFor=function(e,t,n){(n=n||{}).log=n.log||utils.log,t&&n.log(e)},utils.logOnce=function(){var n=0;return function(e,t){(t=t||{}).log=t.log||utils.log,t.maxCount=void 0===t.maxCount?1:t.maxCount,t.resetCount=void 0!==t.resetCount&&t.resetCount,(n=t.resetCount?0:n)<t.maxCount&&(t.log(e),n+=1)}}(),utils.deepClone=function(){function r(e,t,n){return e}function i(e,t,n){return t[n]}var c={Date:function(e,t){return new Date(e.getTime())},Array:function(e,t){e=utils.deepClone(e);return e.length=Object.keys(e).length,Array.from(e)},Object:function(e,t){return utils.deepClone(e)}};return function(e,t){var n,a,o={};for(a in(t=t||{}).forInstance=t.forInstance||{},t.forRecursive=t.forRecursive||r,t.forUnsupported=t.forUnsupported||i,e)"object"==typeof e[a]&&null!=e[a]?e[a]===e?o[a]=t.forRecursive(o,e,a):(n=e[a].constructor.name,n=t.forInstance[n]||c[n],o[a]=n?n(e[a],a):t.forUnsupported(o,e,a)):o[a]=e[a];return o}}(),utils.traverse=function(e,t,n){for(var a in n=n||1,e)t.call(e[a],e[a],a,typeof e[a],n,e),"object"==typeof e[a]&&null!=e[a]&&(nextLevel=n+1,utils.traverse(e[a],t,nextLevel));return null};var canvasMod,poolMod=function(){var r={};return r.create=function(e){(e=e||{}).count=e.count||10;for(var t=0,n={objects:[],secsCap:void 0===e.secsCap?1/0:e.secsCap,disableLifespan:e.disableLifespan||!1,data:e.data||{},spawn:e.spawn||function(e,t,n,a){},purge:e.purge||function(e,t,n){},update:e.update||function(e,t,n,a){}};t<e.count;)n.objects.push({active:!1,i:t,x:void 0===e.x?0:e.x,y:void 0===e.y?0:e.y,w:void 0===e.w?32:e.w,h:void 0===e.h?32:e.h,heading:void 0===e.heading?0:e.heading,pps:void 0===e.pps?32:e.pps,lifespan:e.lifespan||3,data:{}}),t+=1;return n},r.spawn=function(e,t,n){var a=function(e){for(var t,n=e.objects.length;n--;)if(!(t=e.objects[n]).active)return t;return!1}(e);return t=t||{},n=n||{},!(!a||a.active)&&(a.active=!0,e.spawn.call(e,a,e,t,n),a)},r.spawnAll=function(t,n,a){return t.objects.forEach(function(e){if(!e.active)return e.active=!0,t.spawn.call(t,e,t,n,a),e}),t.objects},r.purge=function(e,t,n){t.active=!1,e.purge.call(e,t,e,n)},r.update=function(e,t,n){var a,o=e.objects.length;for(n=n||{},t=t>e.secsCap?e.secsCap:t;o--;)(a=e.objects[o]).active&&(e.update.call(e,a,e,n,t),e.disableLifespan||(a.lifespan-=t,a.lifespan=a.lifespan<0?0:a.lifespan,0===a.lifespan&&(a.active=!1,r.purge.call(e,e,a,n))))},r.setActiveStateForAll=function(e,t){t=void 0!==t&&t;for(var n=e.objects.length;n--;)e.objects[n].active=t},r.moveByPPS=function(e,t){e.x+=Math.cos(e.heading)*e.pps*t,e.y+=Math.sin(e.heading)*e.pps*t},r.checkBounds=function(e,t){return!(e.x>=t.width||e.x<-1*e.w||e.y>t.height||e.y<-1*e.h)},r.boundingBox=function(e,t){return utils.boundingBox(e.x,e.y,e.w,e.h,t.x,t.y,t.w,t.h)},r.wrap=function(e,t,n){utils.boundingBox(e.x,e.y,e.w,e.h,-1*(n=void 0===n?32:n),-1*n,(t=t||{x:0,y:0,width:640,height:480}).width+n,t.height+n)||(e.x=utils.mod(e.x+n,t.width+2*n)-n,e.y=utils.mod(e.y+n,t.height+2*n)-n)},r.getOverlaping=function(e,t){var n,a=0,o=[];if(len=t.objects.length,e.active)for(;a<len;)e!=(n=t.objects[a])&&n.active&&utils.boundingBox(e.x,e.y,e.w,e.h,n.x,n.y,n.w,n.h)&&o.push(n),a+=1;return o},r.getActiveCount=function(e){return e.objects.reduce(function(e,t){return t.active?e+1:e},0)},r.getActiveObjects=function(e){return e.objects.reduce(function(e,t){return t.active&&e.push(t),e},[])},r}();try{Clucker&&(Clucker.poolMod=poolMod)}catch(e){}!function(a){var r={},e=r.drawMethods={};e.clear=function(e,t,n,a){t.clearRect(-2,-2,n.width+2,n.height+2)},e.background=function(e,t,n,a,o){e=o||e.background||"black";"string"==typeof e&&(t.fillStyle=e,t.fillRect(-2,-2,n.width+2,n.height+2)),"object"==typeof e&&t.drawImage(e,-1,-1,n.width+2,n.height+2)},e.print=function(e,t,n,a,o,r,i,c){(c=c||{}).fontSize=c.fontSize||10,t.fillStyle=c.fillStyle||"black",t.textBaseline=c.baseLine||"top",t.textAlign=c.align||"left",t.font=c.fontSize+"px arial",t.fillText(o,r,i)},e.cell=function(e,t,n,a,o,r,i){o=e.spriteSheets[o],r=o.cells[r];t.drawImage(o.image,r.x,r.y,r.w,r.h,i.x,i.y,i.w,i.h)},e.points=function(e,s,t,n,a,o,r,l){l=l||{},s.save(),s.translate(o,r),a.forEach(function(e){var t,n=e.length,a=void 0===l.close||l.close,o=void 0===l.fill?"black":l.fill,r=void 0===l.stroke?"white":l.stroke,i=void 0===l.lineWidth?3:l.lineWidth,c=2;for(s.beginPath(),s.moveTo(e[0],e[1]);c<n;)"number"==typeof(t=e[c])?(s.lineTo(t,e[c+1]),c+=2):("close"===(t=t.split(":"))[0]&&(a="true"===t[1]),"stroke"===t[0]&&(r=t[1]||!1),"fill"===t[0]&&(o=t[1]||!1),"lineWidth"===t[0]&&(i=t[1]||1),c+=1);s.lineWidth=i,a&&s.closePath(),o&&(s.fillStyle=o,s.fill()),r&&(s.strokeStyle=r,s.stroke())}),s.restore()};var o=r.pointsMethods={};o.box=function(e,t,n,a,o){t-=a/4,n-=o/4;return[[t,n,t+a/2,n,t+a/2,n+o/2,t,n+o/2]]};function i(e){var a,o,r,t=(o=(a=e).state,r=e.events,function(e){var t=c(e),n=null;e.preventDefault(),"mousedown"!==e.type&&"touchstart"!==e.type||(n=r.pointerStart),"mousemove"!==e.type&&"touchmove"!==e.type||(n=r.pointerMove),(n="mouseup"===e.type||"touchend"===e.type?r.pointerEnd:n)&&n.call(o,e,t,o,a)}),n=e[e.length-1].canvas,e={passive:!1};n.addEventListener("mousedown",t,e),n.addEventListener("mousemove",t,e),n.addEventListener("mouseup",t,e),n.addEventListener("touchstart",t,e),n.addEventListener("touchmove",t,e),n.addEventListener("touchend",t,e)}var c=function(e){var t=e.target,n=t.getBoundingClientRect(),n={x:(e.changedTouches?e.changedTouches[0]:e).clientX-n.left,y:(e.changedTouches?e.changedTouches[0]:e).clientY-n.top,bx:n};return n.x=Math.floor(n.x/t.scrollWidth*t.width),n.y=Math.floor(n.y/t.scrollHeight*t.height),n};a.createLayerStack=function(e){var t={length:void 0===(e=e||{}).length?2:e.length,container:e.container||document.getElementById("canvas-app")||document.body,events:e.events||{},state:e.state||{},background:e.background||"blue",images:[],spriteSheets:{}};"string"==typeof t.container&&(t.container=document.querySelector(t.container));for(var n={container:t.container,append:!0,width:e.width||320,height:e.height||240},a=0;a<t.length;)t[a]=function(e){(e=e||{}).append=void 0===e.append||e.append;var t={};return t.container=e.container||document.getElementById("canvas-app")||document.body,"string"==typeof t.container&&(t.container=document.querySelector(t.container)),t.canvas=document.createElement("canvas"),t.ctx=t.canvas.getContext("2d"),t.canvas.className="canvas_layer",t.canvas.width=void 0===e.width?320:e.width,t.canvas.height=void 0===e.height?240:e.height,t.ctx.translate(.5,.5),t.canvas.onselectstart=function(){return!1},e.append&&t.container.appendChild(t.canvas),t}(n),t[a].i=a,a+=1;return i(t),t},a.draw=function(e,t,n){var a=e[n],o=[e,a.ctx,a.canvas,a],a=[];3<arguments.length&&(a=Array.prototype.slice.call(arguments,3,arguments.length)),r.drawMethods[t].apply(e,o.concat(a))},a.createPoints=function(e,t){var n=[e],a=Array.prototype.slice.call(arguments,2,arguments.length);return o[t].apply(e,n.concat(a))},a.load=function(e){Object.keys(e).forEach(function(t){e[t].forEach(function(e){r[t][e.name]=e.method})})},a.createSpriteSheet=function(e,t,n,a){var o={name:t,imageIndices:null,cells:[]};"number"==typeof n&&(o.imageIndices=[],o.imageIndices.push(n)),"object"==typeof n&&(o.imageIndices=n),"object"==typeof a&&(o.cells=a),"function"==typeof a&&(o.cells=a.call(e,o.imageIndices,o,e)),e.spriteSheets[t]=o},a.createSpriteSheetGrid=function(e,t,n,l,u){l=void 0===l?32:l,u=void 0===u?32:u,a.createSpriteSheet(e,t,n,function(e,t,n){for(var a,o,e=n.images[e[0]],r=Math.floor(e.width/l),i=r*Math.floor(e.height/u),c=0,s=[];c<i;)a=c%r,o=Math.floor(c/r),s.push({x:l*a,y:u*o,w:l,h:u}),c+=1;return s})}}(void 0===this.Clucker?this.canvasMod={}:Clucker.canvasMod={});try{Clucker&&(canvasMod=Clucker.canvasMod)}catch(e){}canvasMod.load({pointsMethods:[{name:"circle",method:function(e,t,n,a,o){return canvasMod.createPoints(e,"oval",t,n,a,a,o=void 0===o?100:o)}},{name:"oval",method:function(e,t,n,a,o,r){r=void 0===r?100:r;for(var i,c,s=[[]],l=0;l<r;)c=2*Math.PI/r*l,i=t+Math.cos(c)*a,c=n+Math.sin(c)*o,s[0].push(i,c),l+=1;return s}}]}),canvasMod.load({drawMethods:[{name:"pool",method:function(e,t,n,a,o,r){canvasMod.draw(e,"pool-imgd",a.i,o,r)}},{name:"pool-solid",method:function(e,t,n,a,o,r){r=r||{},o.objects.forEach(function(e){t.fillStyle=r.fillStyle||e.data.fillStyle||"white",t.strokeStyle=r.strokeStyle||e.data.strokeStyle||"black",(e.active||r.drawAll)&&(t.beginPath(),t.rect(e.x,e.y,e.w,e.h),t.fill(),t.stroke())})}},{name:"pool-imgd",method:function(e,a,t,n,o,r){r=r||{},o.objects.forEach(function(e){var t=r.image||e.data.image||!1,n=r.imgD||e.data.imgD||{};a.fillStyle=r.fillStyle||e.data.fillStyle||"white",a.strokeStyle=r.strokeStyle||e.data.strokeStyle||"black",(e.active||r.drawAll)&&(t?a.drawImage(t,n.x,n.y,n.w,n.h,e.x,e.y,e.w,e.h):(a.beginPath(),a.rect(e.x,e.y,e.w,e.h),a.fill(),a.stroke()))})}},{name:"sprite",method:function(e,t,n,a,o,r){var i=(r=r||{}).sheetKey||o.data.sheetKey||"default",c=0;0<=o.data.cellIndex&&(c=o.data.cellIndex),0<=r.cellIndex&&(c=r.cellIndex),t.globalAlpha=void 0===o.data.alpha?1:o.data.alpha;var s=e.spriteSheets[i];s?(o.active||r.drawAll)&&(i=void 0===o.data.imageIndex?0:o.data.imageIndex,i=e.images[s.imageIndices[i]],c=s.cells[c],t.drawImage(i,c.x,c.y,c.w,c.h,o.x,o.y,o.w,o.h)):canvasMod.draw(e,"pool-solid",a.i,pool,r)}},{name:"pool-sprite",method:function(t,e,n,a,o,r){o.objects.forEach(function(e){canvasMod.draw(t,"sprite",a.i,e,{})}),e.globalAlpha=1}}]}),canvasMod.load({drawMethods:[{name:"button",method:function(e,t,n,a,o){var r,i,c={align:"center",baseLine:"middle",fontSize:o.descSize||10};t.fillStyle="white",t.strokeStyle="black",t.beginPath(),t.rect(o.x,o.y,o.w,o.h),t.fill(),t.stroke(),o.minor?(r=o.x+o.w/2,i=o.y+o.h/3,canvasMod.draw(e,"print",a.i,o.desc,r,i,c),i+=o.h/3,c.fontSize=o.minorSize||10,canvasMod.draw(e,"print",a.i,o.minor,r,i,c)):(r=o.x+o.w/2,i=o.y+o.h/2,canvasMod.draw(e,"print",a.i,o.desc,r,i,c))}},{name:"stateButtons",method:function(t,e,n,a,o){var r=o.states[o.currentState];Object.keys(r.buttons).forEach(function(e){e=r.buttons[e];canvasMod.draw(t,"button",a.i,e)})}}]}),function(t){t.createToStateButton=function(o,e,t,n,a,r){return{x:void 0===e?0:e,y:void 0===t?0:t,w:void 0===a?64:a,h:void 0===r?64:r,desc:n||"Back",onClick:function(e,t,n,a){Clucker.gameFrame.smSetState(n,o)}}},t.smCreateMin=function(e){return{currentState:(e=e||{}).currentState||"",data:{},stateObj:{},states:e.states||{},events:e.events||{}}};function a(e,t,n,a){var o,r=a.states[a.currentState];r&&(o=r.events[e])&&o.call(a,t,n,a)}function o(e){Clucker.gameFrame.smPushState(e,{name:"loader",start:function(e){e.states.loader.data.loaded=0,canvasMod.draw(e.layers,"background",0),e.images=[];var a=e.layers.images=[];e.loader;if(e.loader.images)for(var t=0;t<e.loader.images.count;)!function(n){utils.httpPNG({url:e.loader.images.baseURL+"/"+n+".png",onDone:function(e,t){console.log("image "+n+" loaded: "),a[n]=e},onError:function(){console.log("error"),e.images[n]=new Image,a[n]=new Image}})}(t),t+=1},end:function(e){canvasMod.draw(e.layers,"clear",0),canvasMod.draw(e.layers,"clear",1)},update:function(e,t){(e.states.loader.data.loaded=e.layers.images.reduce(function(e,t){return void 0===t?e:e+1},0))===e.loader.images.count&&Clucker.gameFrame.smSetState(e,e.loader.startState||"game")},draw:function(e,t){var n=t[1].ctx,a=t[1].canvas,o=a.width/2,r=a.height/2,i=e.states.loader.data.loaded;canvasMod.draw(t,"clear",1),e.loader.images&&(n.fillStyle="white",n.strokeStyle="black",n.beginPath(),n.rect(0,r-10,a.width*(i/e.loader.images.count),10),n.fill(),n.stroke(),canvasMod.draw(t,"print",1,i+" / "+e.loader.images.count,o,15+r,{align:"center",fontSize:30}))}})}t.smCreateMain=function(e){var n=t.smCreateMin(e=e||{});return n.ver=e.ver||"",n.game=e.game||{},n.fps=void 0===e.fps?30:e.fps,n.loader=e.loader||{},n.images=[],n.events=e.events||{pointerStart:function(e,t,n){!function(e,t,n){for(var a,o=n.states[n.currentState],r=Object.keys(o.buttons),i=0,c=r.length;i<c;)a=o.buttons[r[i]],utils.boundingBox(a.x,a.y,a.w,a.h,t.x,t.y,1,1)&&a.onClick.call(n,e,t,n,a),i+=1}(e,t,n),a("pointerStart",e,t,n)},pointerMove:function(e,t,n){a("pointerMove",e,t,n)},pointerEnd:function(e,t,n){a("pointerEnd",e,t,n)}},n.layers=canvasMod.createLayerStack({length:void 0===e.canvasLayers?3:e.canvasLayers,container:e.canvasContainer||document.getElementById("canvas-app")||document.body,events:n.events,state:n,width:e.width,height:e.height}),n.debugMode=e.debugMode||!1,n.secs=0,n.stopLoop=!1,n.lt=new Date,n.loader.images&&o(n),n.loop=function(){var e,t=new Date;n.secs=(t-n.lt)/1e3,n.secs>=1/n.fps&&((e=n.stateObj.update)&&e.call(n,n,n.secs),(e=n.stateObj.draw)&&e.call(n,n,n.layers,canvasMod),n.lt=t),n.stopLoop||requestAnimationFrame(n.loop)},n.currentState&&(n.stateObj=n.states[n.currentState]),n},t.smPushState=function(e,t){var n={name:t.name||"state_"+Object.keys(e.states).length,data:t.data||{}};return n.buttons=t.buttons||{},n.start=t.start||function(){},n.end=t.end||function(){},n.update=t.update||function(){},n.draw=t.draw||function(){},n.events=t.events||{},e.states[n.name]=n},t.smSetState=function(e,t){var n=e.states[e.currentState];!n||(n=n.end)&&n.call(e,e),e.currentState=t;t=(t=e.stateObj=e.states[e.currentState]).start;t&&t.call(e,e,canvasMod)}}(void 0===this.Clucker?this.gameFrame={}:Clucker.gameFrame={}),this.Clucker&&(Clucker.createMain=function(e){return Clucker.gameFrame.smCreateMain(e)},Clucker.pushState=function(e,t){return Clucker.gameFrame.smPushState(e,t)},Clucker.setState=function(e,t){return Clucker.gameFrame.smSetState(e,t)}),function(i){function c(e){var t="$"+e.levelObj.forNext;return"("+e.levelObj.level+") "+t}var s=function(e,t){for(var n=t.split("."),a=e;0<n.length;)a=a[n.shift()];return a};i.applyUpgradesToState=function(t,e){var n=s(t,e.upgradesPath);Object.keys(n).forEach(function(e){e=n[e];e.applyToState.call(t,t,e,e.levelObj.level)})};function r(e,o,a){var r=e.states[o.upgradeStateKey];Object.keys(a).forEach(function(e,t){var n=a[e];r.buttons["upgrade_"+e]={x:32,y:128+72*t,w:256,h:64,upgradeKey:e,desc:n.desc,minor:c(n),descSize:20,onClick:function(e,t,n,a){!function(e,t,n){console.log("buying upgrade");var a=s(e,t.upgradesPath)[n];t.onBuyUpgrade(e,a)&&(n=a.levelObj.level+1,a.levelObj=Clucker.utils.XP.parseByLevel(n,a.cap,a.deltaNext),i.applyUpgradesToState(e,t))}(n,o,a.upgradeKey),a.minor=c(n.game.upgrades[a.upgradeKey])}}})}i.createState=function(e,a){(a=a||{}).buttonLayer=a.buttonLayer||2,a.upgradeStateKey=a.upgradeStateKey||"upgrades",a.gameStateKey=a.gameStateKey||"game",a.menuStateKey=a.menuStateKey||"menu",a.update=a.update||function(){},a.upgradesPath=a.upgradesPath||"game.upgrades",a.onBuyUpgrade=a.onBuyUpgrade||function(e,t){return!0};var o=e.layers[0].canvas.width;e.layers[0].canvas.height;return{name:a.upgradeStateKey,buttons:{},start:function(e,t){var n=e.stateObj.buttons={};n.to_game=Clucker.gameFrame.createToStateButton(a.gameStateKey,o-64-16,16,"Game"),n.game=Clucker.gameFrame.createToStateButton(a.menuStateKey,16,16,"Back");n=s(e,a.upgradesPath);r(e,a,n)},update:function(e,t){a.update(e,t)},draw:function(e,t,n){n.draw(t,"clear",a.buttonLayer),n.draw(t,"stateButtons",a.buttonLayer,e)}}}}(void 0===this.Clucker?this.upgrades={}:Clucker.upgrades={});
}(this['Clucker'] = {ver:'0.6.3'}));